# 📱 iPhoneでWebアプリを使う方法

## 🚀 方法1: Render.comで無料デプロイ（推奨）

### ステップ1: Render.comアカウント作成
1. https://render.com にアクセス
2. GitHubアカウントでサインアップ（無料）

### ステップ2: GitHubリポジトリを接続
1. Renderダッシュボードで **"New +"** → **"Web Service"** をクリック
2. **"Build and deploy from a Git repository"** を選択
3. このリポジトリ（`100_keirin`）を選択
4. ブランチ: `claude/understand-requirements-012gmdy58xGw6CXeV5oTGeAi` を選択

### ステップ3: デプロイ設定
以下の設定を入力：

```
Name: keirin-predictor (任意の名前)
Runtime: Python 3
Build Command: pip install -r requirements.txt
Start Command: python web_app.py
Instance Type: Free
```

### ステップ4: 環境変数を設定
**Environment Variables** セクションで以下を追加：

```
HOST = 0.0.0.0
PORT = 8000
KEIRIN_ENABLE_LIGHTGBM = 1
```

### ステップ5: デプロイ開始
1. **"Create Web Service"** をクリック
2. デプロイが完了するまで5〜10分待つ
3. URLが生成されます：`https://keirin-predictor.onrender.com`

### ステップ6: iPhoneでアクセス
1. iPhoneのSafariまたはChromeを開く
2. 生成されたURLにアクセス
3. ホーム画面に追加（PWAとして使える）

---

## 🏠 方法2: ローカルネットワークで使う

PCとiPhoneが**同じWi-Fiネットワーク**に接続されている場合：

### ステップ1: PCでサーバー起動
```bash
cd /path/to/100_keirin
python web_app.py
```

### ステップ2: PCのIPアドレスを確認

**Mac:**
```bash
ipconfig getifaddr en0
```

**Windows:**
```cmd
ipconfig
```

**Linux:**
```bash
hostname -I | awk '{print $1}'
```

例: `192.168.1.100`

### ステップ3: iPhoneでアクセス
iPhoneのブラウザで以下にアクセス：
```
http://192.168.1.100:8000
```

---

## 📊 使い方

### 1. レース情報を入力
- **レース日**: 2025-01-15
- **開催場**: 京王閣
- **会場コード**: 27
- **レース番号**: 7
- **グレード**: F1

### 2. 選手情報を入力（最大9名）
各選手について：
- **名前**: 山田太郎
- **府県**: 東京
- **階級**: S1、S2、A1、A2、A3など
- **脚質**: 逃（逃げ）、追（追い込み）、両（自在）
- **得点**: 109.5（平均競走得点）

### 3. 予測を実行
「予測を実行する」ボタンをクリック

### 4. 結果を確認

#### 表示される情報：
- **荒れ度合い確率**: 三連単10,000円以上になる確率
- **信頼度**: 高・中・低
- **推奨アクション**: 勝負レース / 様子見 / 見送り

#### 推奨ベットプラン：
- **リスクレベル**: ハイリスク / ミドルリスク / ローリスク
- **買い目提案**: 三連単フォーメーション、三連複など
- **資金配分**: 予算の何%を投下すべきか
- **ヘッジ戦略**: リスク分散の方法

#### 予測ロジック：
- 選手の得点差が大きい → 波乱要素
- 脚質の多様性 → 展開が読みづらい
- S級上位の比率 → 順当決着の可能性

---

## ⚡ パフォーマンス

- **予測速度**: 0.065秒（超高速）
- **モバイル最適化**: iPhone完全対応
- **オフライン**: 対応していません（サーバー接続が必要）

---

## 🔒 セキュリティとプライバシー

- **個人情報**: 収集しません
- **レース結果**: サーバーに保存されません
- **予測履歴**: ブラウザのみに保存（任意）

---

## 🐛 トラブルシューティング

### 予測が遅い/タイムアウトする
- ネットワーク接続を確認
- Render.comの無料プランはスリープします（初回アクセス時に30秒ほど待つ）
- リロードして再試行

### 「モデルが未学習です」エラー
モデルファイルが存在しない場合：
```bash
python analysis/train_prerace_lightgbm.py
```

### iPhoneでアクセスできない（ローカル接続）
- PCとiPhoneが同じWi-Fiに接続されているか確認
- ファイアウォールでポート8000が許可されているか確認
- PCのIPアドレスが正しいか再確認

---

## 📝 注意事項

### 免責事項
- 本ツールは過去データに基づく統計的推定です
- 実際の結果を保証するものではありません
- 投票は自己責任で行ってください
- ギャンブル依存症にご注意ください

### 使用している特徴量（すべて事前情報）
✅ 選手の得点統計
✅ 脚質の構成と多様性
✅ 階級の構成
✅ 開催日程（初日・最終日など）
✅ 地域の多様性

❌ 人気順位（オッズ）は使用していません
❌ レース結果は使用していません

---

## 🎯 モデル性能

現在のモデル：
- **ROC-AUC**: 0.58
- **Precision@Top100**: 0.68
- **データ期間**: 2024年1月〜2025年10月（48,692レース）

事前情報のみという制約の中では妥当な性能です。

---

## 📞 サポート

問題が発生した場合：
1. GitHubのIssuesで報告
2. ログファイルを確認（デバッグモード）
3. モデルの再訓練を試す

---

## 🔄 モデルの更新

データを最新に保つには：

### 1. データ収集
```bash
python scripts/fetch_keirin_results.py --start 20250101 --end 20250131
python scripts/fetch_keirin_prerace.py --start 20250101 --end 20250131
python scripts/fetch_keirin_race_detail.py --start 20250101 --end 20250131
```

### 2. データセット再構築
```bash
python analysis/build_training_dataset.py
```

### 3. モデル再訓練
```bash
python analysis/train_prerace_lightgbm.py
```

### 4. 再デプロイ
変更をコミット＆プッシュすると、Renderが自動的に再デプロイします。

---

**楽しい競輪ライフを！🚴💨**
